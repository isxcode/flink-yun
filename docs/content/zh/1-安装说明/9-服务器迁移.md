---
title: "服务器迁移"
---

## 服务器迁移

#### 数据备份

```bash
cd /opt/zhiliuyun
# 压缩数据
tar -czvf resources.tar.gz resources
tar -czvf resources_bak.tar.gz resources_bak
# 下载数据
scp root@101.132.73.85:/opt/zhiliuyun/resources.tar.gz ~/Downloads/
scp root@101.132.73.85:/opt/zhiliuyun/resources_bak.tar.gz ~/Downloads/
```

#### 项目配置文件备份

```bash
scp root@101.132.73.85:/root/application-local.yml ~/Downloads/
```

#### ssl证书备份

```bash
scp root@101.132.73.85:/root/zhiliuyun-demo.isxcode.com.key ~/Downloads/
scp root@101.132.73.85:/root/zhiliuyun-demo.isxcode.com.pem ~/Downloads/
scp root@101.132.73.85:/root/zhiliuyun.isxcode.com.key ~/Downloads/
scp root@101.132.73.85:/root/zhiliuyun.isxcode.com.pem ~/Downloads/
```

#### nginx配置文件备份

```bash
scp root@101.132.73.85:/etc/nginx/nginx.conf ~/Downloads/
```

#### 新服务器端口号开放

- 系统：CentOS8.5
- 端口号开放：22、80、443

#### 新服务器-java安装

```bash
scp /Users/ispong/OneDrive/Downloads/linux/java/zulu8.78.0.19-ca-jdk8.0.412-linux_x64.tar.gz root@101.132.73.85:/tmp
tar -vzxf /tmp/zulu8.78.0.19-ca-jdk8.0.412-linux_x64.tar.gz -C /opt
ln -s /opt/zulu8.78.0.19-ca-jdk8.0.412-linux_x64 /opt/java
tee -a ~/.bashrc <<-'EOF'
export JAVA_HOME=/opt/java
export PATH=$PATH:$JAVA_HOME/bin
EOF
source ~/.bashrc
rm -f /tmp/zulu8.78.0.19-ca-jdk8.0.412-linux_x64.tar.gz
java -version
```

#### 新服务器-nodejs安装

```bash
scp /Users/ispong/OneDrive/Downloads/linux/node/node-v18.20.5-linux-x64.tar.xz root@101.132.73.85:/tmp
cd /tmp
tar -xvJf node-v18.20.5-linux-x64.tar.xz
mv node-v18.20.5-linux-x64 /opt/
ln -s /opt/node-v18.20.5-linux-x64 /opt/node 
tee -a ~/.bashrc <<-'EOF'
export NODE_HOME=/opt/node 
export PATH=$PATH:${NODE_HOME}/bin
EOF
source ~/.bashrc
npm config set registry https://registry.npmmirror.com/
npm install pm2 -g
rm -f /tmp/node-v18.20.5-linux-x64.tar.xz
pm2 -version
```

#### 新服务器-nginx安装

```bash
scp /Users/ispong/OneDrive/Downloads/linux/nginx/nginx-1.26.2-1.el8.ngx.x86_64.rpm root@101.132.73.85:/tmp
cd /tmp
rpm -ivh nginx-1.26.2-1.el8.ngx.x86_64.rpm
rm -f /tmp/nginx-1.26.2-1.el8.ngx.x86_64.rpm
nginx
ps -C nginx -o pid= | head -n 1 | awk '{print $1}' > /run/nginx.pid
cat /run/nginx.pid
```

#### 上传文件

```bash
scp /Users/ispong/Downloads/zhiliuyun-demo.isxcode.com.pem root@101.132.73.85:/root
scp /Users/ispong/Downloads/zhiliuyun-demo.isxcode.com.key root@101.132.73.85:/root
scp /Users/ispong/Downloads/zhiliuyun.isxcode.com.key root@101.132.73.85:/root
scp /Users/ispong/Downloads/zhiliuyun.isxcode.com.pem root@101.132.73.85:/root
scp /Users/ispong/Downloads/application-local.yml root@101.132.73.85:/root
scp /Users/ispong/Downloads/resources.tar.gz root@101.132.73.85:/root
scp /Users/ispong/Downloads/nginx.conf root@101.132.73.85:/root
```

#### 移动文件

```bash
mkdir -p /data/nginx/ssl/
cp /root/zhiliuyun-demo.isxcode.com.pem /data/nginx/ssl/
cp /root/zhiliuyun-demo.isxcode.com.key /data/nginx/ssl/
cp /root/zhiliuyun.isxcode.com.pem /data/nginx/ssl/
cp /root/zhiliuyun.isxcode.com.key /data/nginx/ssl/

mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf_bak
mv /root/nginx.conf /etc/nginx/nginx.conf

mkdir -p /opt/zhiliuyun
mkdir -p /opt/zhiliuyun/resources_bak
tar -vzxf /root/resources.tar.gz -C /opt/zhiliuyun
rm -f /root/resources.tar.gz
```

#### github启动前端脚本

- https://github.com/isxcode/flink-yun/actions/workflows/website-deploy.yml

#### github启动后端脚本

- https://github.com/isxcode/flink-yun/actions/workflows/zhiliuyun-deploy.yml